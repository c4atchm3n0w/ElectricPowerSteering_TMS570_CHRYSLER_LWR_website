---
title: Os
linkTitle: Os
weight: 7
---

<p><strong>Module -- OS</strong></p>
<p><a href="#references">1 References 2</a></p>
<p><a href="#isr-configuration">2 ISR Configuration 3</a></p>
<p><a href="#gpt_isrint0">2.1 Gpt_IsrInt0 3</a></p>
<p><a href="#isr_esmh">2.2 Isr_ESMH 4</a></p>
<p><a href="#isr_mtrctrl">2.3 Isr_MtrCtrl 5</a></p>
<p><a href="#spi_irqunit0txrx">2.4 Spi_IrqUnit0TxRx 6</a></p>
<p><a href="#spi_irqunit0txrxerr">2.5 Spi_IrqUnit0TxRxERR 7</a></p>
<p><a href="#task-configuration">3 Task Configuration 7</a></p>
<p><a href="#os-configuration">4 Os Configuration 7</a></p>
<p><a href="#ososapioptimization">4.1 OsOSAPIOptimization 7</a></p>
<p><a href="#applications-configuration">5 Applications Configuration 7</a></p>
<p><a href="#assist-primary-control-task-scheduling">6 Assist Primary Control Task Scheduling 7</a></p>
<p><a href="#known-issues-limitations-with-configuration">7 Known Issues / Limitations With Configuration 8</a></p>
<p><a href="#code-alterations">8 Code Alterations 8</a></p>
<p><a href="#generated-code">8.1 Generated Code 8</a></p>
<p><a href="#static-code">8.2 Static Code 8</a></p>
<p><a href="#revision-control-log">9 Revision Control Log 10</a></p>
<p>11</p>
<h1 id="references">References</h1>
<ol type="1">
<li><p>MICROSAR OS OSEK/Autosar Realtime Operating System Technical Reference (<a href="../../../../../../Vector/CBD1000133_D00_Tmsx70/Doc/TechnicalReferences/TechnicalReference_osCAN4.pdf">TechnicalReference_osCAN4.pdf</a>)</p></li>
<li><p>AUTOSAR realtime operating system MICROSAR OS TMS570 User’s Manual (<a href="../../../../../../Vector/CBD1000133_D01_Tmsx70/Doc/UserManuals/MicrosarOS_TMS570.pdf">MicrosarOS_TMS570.pdf</a>)</p></li>
<li><p>TMS570LS3137PGE 16/32-Bit RISC Flash Microcontroller (SPNS166_TMS570LS3137SPGE Prelim.pdf)</p></li>
<li><p>Cortex-R4 and Cortex-R4F Technical Reference Manual (DDIO363E_cortexr4_r1p3_trm.pdf)</p></li>
</ol>
<h1 id="isr-configuration">ISR Configuration</h1>
<h2 id="gpt_isrint0">Gpt_IsrInt0</h2>
<table>
<colgroup>
<col style="width: 29%" />
<col style="width: 26%" />
<col style="width: 43%" />
</colgroup>
<tbody>
<tr class="odd">
<td><strong>Attribute Name</strong></td>
<td><strong>Value</strong></td>
<td><strong>Rationale</strong></td>
</tr>
<tr class="even">
<td colspan="3">General Settings</td>
</tr>
<tr class="odd">
<td>OsIsrCategory</td>
<td>Category_2</td>
<td>Category 2 configured to allow preemption concerns to be handled by the Os,</td>
</tr>
<tr class="even">
<td>OsIsrEnableNesting</td>
<td>TRUE</td>
<td>Allow the Motor control ISR to preempt.</td>
</tr>
<tr class="odd">
<td>OsIsrAnalysisPriority</td>
<td>0</td>
<td>Default value same as other Demo project ISR’s, this value is used for correctly configuring the osCAN external timing analysis tool. At some point in the future, a correct value should be determined for this.</td>
</tr>
<tr class="even">
<td>OsIsrComputationTime</td>
<td>0</td>
<td>See above rationale</td>
</tr>
<tr class="odd">
<td>OsIsrPeriod</td>
<td>0</td>
<td>See above rationale</td>
</tr>
<tr class="even">
<td>OsIsrDeadline</td>
<td>0</td>
<td>See above rationale</td>
</tr>
<tr class="odd">
<td>OsIsrInterruptTarget</td>
<td>IRQ</td>
<td>Cat2 requires IRQ. FIQ not required to meet the ISR execution deadline.</td>
</tr>
<tr class="even">
<td>OsIsrInterruptSource</td>
<td>INTR2</td>
<td>“RTI compare interrupt 0” is default VIM interrupt request 2 per [3]</td>
</tr>
<tr class="odd">
<td>OsIsrResourceRef</td>
<td>&lt;Empty&gt;</td>
<td><strong>TBD</strong></td>
</tr>
<tr class="even">
<td>OsIsrMESSAGE</td>
<td>&lt;Empty&gt;</td>
<td><strong>TBD</strong></td>
</tr>
<tr class="odd">
<td>OsIsrInterruptPriority</td>
<td>4</td>
<td>In order to ensure that this Isr does not interfere with the Motor control its priority is being placed below the MtrCtrl interrupt.</td>
</tr>
<tr class="even">
<td>OsIsrUseSpecialFunctionName</td>
<td>FALSE</td>
<td></td>
</tr>
</tbody>
</table>
<h2 id="isr_esmh">Isr_ESMH</h2>
<table>
<colgroup>
<col style="width: 29%" />
<col style="width: 26%" />
<col style="width: 43%" />
</colgroup>
<tbody>
<tr class="odd">
<td><strong>Attribute Name</strong></td>
<td><strong>Value</strong></td>
<td><strong>Rationale</strong></td>
</tr>
<tr class="even">
<td colspan="3">General Settings</td>
</tr>
<tr class="odd">
<td>OsIsrCategory</td>
<td>Category_1</td>
<td>Fast ISR service desired, OS services not required</td>
</tr>
<tr class="even">
<td>OsIsrEnableNesting</td>
<td>FALSE</td>
<td><p>Prevent Interrupt preemption while serving ESM interrupt.</p>
<p>Although it seems that this parameter does not apply to a Category 1 interrupt since the OS is not involved with the assertion of the ISR. So the value of this parameter should have no effect.</p></td>
</tr>
<tr class="odd">
<td>OsIsrAnalysisPriority</td>
<td>0</td>
<td>Default value same as other Demo project ISR’s, this value is used for correctly configuring the osCAN external timing analysis tool. At some point in the future, a correct value should be determined for this.</td>
</tr>
<tr class="even">
<td>OsIsrComputationTime</td>
<td>0</td>
<td>See above rationale</td>
</tr>
<tr class="odd">
<td>OsIsrPeriod</td>
<td>0</td>
<td>See above rationale</td>
</tr>
<tr class="even">
<td>OsIsrDeadline</td>
<td>0</td>
<td>See above rationale</td>
</tr>
<tr class="odd">
<td>OsIsrInterruptTarget</td>
<td>FIQ</td>
<td>ESMH interrupt is by nature a Non Maskable Interrupt and is service through FIQ.</td>
</tr>
<tr class="even">
<td>OsIsrInterruptSource</td>
<td>INTR0</td>
<td>Trigger is the ESM High Level Interrupt</td>
</tr>
<tr class="odd">
<td>OsIsrResourceRef</td>
<td>&lt;Empty&gt;</td>
<td><strong>TBD</strong></td>
</tr>
<tr class="even">
<td>OsIsrMESSAGE</td>
<td>&lt;Empty&gt;</td>
<td><strong>TBD</strong></td>
</tr>
<tr class="odd">
<td>OsIsrInterruptPriority</td>
<td>0</td>
<td>VIM priority “0” is reserved for ESM module. Default value is desired.</td>
</tr>
<tr class="even">
<td>OsIsrUseSpecialFunctionName</td>
<td>FALSE</td>
<td>Single interrupt source for the ESM ISR, so using the name of this ISR container is fine.</td>
</tr>
</tbody>
</table>
<h2 id="isr_mtrctrl">Isr_MtrCtrl</h2>
<table>
<colgroup>
<col style="width: 29%" />
<col style="width: 26%" />
<col style="width: 43%" />
</colgroup>
<tbody>
<tr class="odd">
<td><strong>Attribute Name</strong></td>
<td><strong>Value</strong></td>
<td><strong>Rationale</strong></td>
</tr>
<tr class="even">
<td colspan="3">General Settings</td>
</tr>
<tr class="odd">
<td>OsIsrCategory</td>
<td>Category_1</td>
<td>Fast ISR service desired, OS services not required</td>
</tr>
<tr class="even">
<td>OsIsrEnableNesting</td>
<td>FALSE</td>
<td><p>Prevent Interrupt preemption while serving motor control.</p>
<p>Although it seems that this parameter does not apply to a Category 1 interrupt since the OS is not involved with the assertion of the ISR. So the value of this parameter should have no effect.</p></td>
</tr>
<tr class="odd">
<td>OsIsrAnalysisPriority</td>
<td>0</td>
<td>Default value same as other Demo project ISR’s, this value is used for correctly configuring the osCAN external timing analysis tool. At some point in the future, a correct value should be determined for this.</td>
</tr>
<tr class="even">
<td>OsIsrComputationTime</td>
<td>0</td>
<td>See above rationale</td>
</tr>
<tr class="odd">
<td>OsIsrPeriod</td>
<td>0</td>
<td>See above rationale</td>
</tr>
<tr class="even">
<td>OsIsrDeadline</td>
<td>0</td>
<td>See above rationale</td>
</tr>
<tr class="odd">
<td>OsIsrInterruptTarget</td>
<td>IRQ</td>
<td><p>FIQ desired since this ISR is high priority and is not to be preempted by any other source.</p>
<p>Due to unexplained missed FlexRay interrupts when an FIQ is configured, this is being configured as an IRQ as a workaround.</p></td>
</tr>
<tr class="even">
<td>OsIsrInterruptSource</td>
<td>INTR50</td>
<td>Trigger for motor control ISR is the completion of the ADC2 group 1 conversion triggered by the NHET.</td>
</tr>
<tr class="odd">
<td>OsIsrResourceRef</td>
<td>&lt;Empty&gt;</td>
<td><strong>TBD</strong></td>
</tr>
<tr class="even">
<td>OsIsrMESSAGE</td>
<td>&lt;Empty&gt;</td>
<td><strong>TBD</strong></td>
</tr>
<tr class="odd">
<td>OsIsrInterruptPriority</td>
<td>2</td>
<td>This is the highest priority interrupt in the system. VIM priority scheme reserves priorities 0 and 1. 2 is the highest priority assignment available.</td>
</tr>
<tr class="even">
<td>OsIsrUseSpecialFunctionName</td>
<td>FALSE</td>
<td>Single interrupt source for the motor control ISR, so using the name of this ISR container is fine.</td>
</tr>
</tbody>
</table>
<h2 id="spi_irqunit0txrx">Spi_IrqUnit0TxRx</h2>
<table>
<colgroup>
<col style="width: 29%" />
<col style="width: 26%" />
<col style="width: 43%" />
</colgroup>
<tbody>
<tr class="odd">
<td><strong>Attribute Name</strong></td>
<td><strong>Value</strong></td>
<td><strong>Rationale</strong></td>
</tr>
<tr class="even">
<td colspan="3">General Settings</td>
</tr>
<tr class="odd">
<td>OsIsrCategory</td>
<td>Category_2</td>
<td>Category 2 configured to allow preemption concerns to be handled by the Os,</td>
</tr>
<tr class="even">
<td>OsIsrEnableNesting</td>
<td>TRUE</td>
<td><p>The SPI communication is only used for EEPROM servicing and is low priority. Allow the CAN interrupt, System Tick, and Motor Control to preempt.</p>
<p><strong>TBD</strong> if Category_1 interrupts can always preempt Category_2..</p></td>
</tr>
<tr class="odd">
<td>OsIsrAnalysisPriority</td>
<td>0</td>
<td>Default value same as other Demo project ISR’s, this value is used for correctly configuring the osCAN external timing analysis tool. At some point in the future, a correct value should be determined for this.</td>
</tr>
<tr class="even">
<td>OsIsrComputationTime</td>
<td>0</td>
<td>See above rationale</td>
</tr>
<tr class="odd">
<td>OsIsrPeriod</td>
<td>0</td>
<td>See above rationale</td>
</tr>
<tr class="even">
<td>OsIsrDeadline</td>
<td>0</td>
<td>See above rationale</td>
</tr>
<tr class="odd">
<td>OsIsrInterruptTarget</td>
<td>IRQ</td>
<td>Cat2 requires IRQ. FIQ not required to meet the ISR execution deadline.</td>
</tr>
<tr class="even">
<td>OsIsrInterruptSource</td>
<td>INTR26</td>
<td>Trigger for EEPROM SPI MIBSPI1 per CCA schematic.</td>
</tr>
<tr class="odd">
<td>OsIsrResourceRef</td>
<td>&lt;Empty&gt;</td>
<td><strong>TBD</strong></td>
</tr>
<tr class="even">
<td>OsIsrMESSAGE</td>
<td>&lt;Empty&gt;</td>
<td><strong>TBD</strong></td>
</tr>
<tr class="odd">
<td>OsIsrInterruptPriority</td>
<td>26</td>
<td><strong>TBD</strong></td>
</tr>
<tr class="even">
<td>OsIsrUseSpecialFunctionName</td>
<td>FALSE</td>
<td><strong>TBD</strong></td>
</tr>
</tbody>
</table>
<h2 id="spi_irqunit0txrxerr">Spi_IrqUnit0TxRxERR</h2>
<table>
<colgroup>
<col style="width: 29%" />
<col style="width: 26%" />
<col style="width: 43%" />
</colgroup>
<tbody>
<tr class="odd">
<td><strong>Attribute Name</strong></td>
<td><strong>Value</strong></td>
<td><strong>Rationale</strong></td>
</tr>
<tr class="even">
<td colspan="3">General Settings</td>
</tr>
<tr class="odd">
<td>OsIsrCategory</td>
<td>Category_2</td>
<td>Category 2 configured to allow preemption concerns to be handled by the Os,</td>
</tr>
<tr class="even">
<td>OsIsrEnableNesting</td>
<td>TRUE</td>
<td><p>The SPI communication is only used for EEPROM servicing and is low priority. Allow the CAN interrupt, System Tick, and Motor Control to preempt.</p>
<p><strong>TBD</strong> if Category_1 interrupts can always preempt Category_2..</p></td>
</tr>
<tr class="odd">
<td>OsIsrAnalysisPriority</td>
<td>0</td>
<td>Default value same as other Demo project ISR’s, this value is used for correctly configuring the osCAN external timing analysis tool. At some point in the future, a correct value should be determined for this.</td>
</tr>
<tr class="even">
<td>OsIsrComputationTime</td>
<td>0</td>
<td>See above rationale</td>
</tr>
<tr class="odd">
<td>OsIsrPeriod</td>
<td>0</td>
<td>See above rationale</td>
</tr>
<tr class="even">
<td>OsIsrDeadline</td>
<td>0</td>
<td>See above rationale</td>
</tr>
<tr class="odd">
<td>OsIsrInterruptTarget</td>
<td>IRQ</td>
<td>Cat2 requires IRQ. FIQ not required to meet the ISR execution deadline.</td>
</tr>
<tr class="even">
<td>OsIsrInterruptSource</td>
<td>INTR12</td>
<td>Trigger for EEPROM SPI MIBSPI1 per CCA schematic.</td>
</tr>
<tr class="odd">
<td>OsIsrResourceRef</td>
<td>&lt;Empty&gt;</td>
<td><strong>TBD</strong></td>
</tr>
<tr class="even">
<td>OsIsrMESSAGE</td>
<td>&lt;Empty&gt;</td>
<td><strong>TBD</strong></td>
</tr>
<tr class="odd">
<td>OsIsrInterruptPriority</td>
<td>12</td>
<td><strong>TBD</strong></td>
</tr>
<tr class="even">
<td>OsIsrUseSpecialFunctionName</td>
<td>FALSE</td>
<td><strong>TBD</strong></td>
</tr>
</tbody>
</table>
<h1 id="task-configuration">Task Configuration</h1>
<h1 id="os-configuration">Os Configuration</h1>
<h2 id="ososapioptimization">OsOSAPIOptimization</h2>
<h1 id="applications-configuration">Applications Configuration</h1>
<h1 id="assist-primary-control-task-scheduling">Assist Primary Control Task Scheduling</h1>
<p>The assist primary control task scheduling requires both low execution period jitter and low latency relative to the ADC measurements on the signals required for the control computations.</p>
<blockquote>
<p>TO BE COMPLETED</p>
</blockquote>
<h1 id="known-issues-limitations-with-configuration">Known Issues / Limitations With Configuration</h1>
<ol type="1">
<li><p>Configuration has not been fully reviewed and is based on the Vector Demo project delivered with the SIP.</p></li>
</ol>
<h1 id="code-alterations">Code Alterations</h1>
<h2 id="generated-code">Generated Code</h2>
<blockquote>
<p>The generated configuration requires modifications to be suitable for the Nexteer project. The following table lists the changes required and the rationale.</p>
<p>Included in the GenDataOs folder are a set of scripts and unified diff files to assist in automatically performing the modifications to the generated files. At this time, execution of the Os_Patch.bat script has not been added to the Vector Configurator Os generation step. The user generating the new Os configuration is responsible for launching the Os_Patch.bat script after Os generation and ensuring that the modifications are performed correctly. A future improvement is to further automate the process of applying the modifications.</p>
</blockquote>
<table>
<colgroup>
<col style="width: 16%" />
<col style="width: 57%" />
<col style="width: 25%" />
</colgroup>
<tbody>
<tr class="odd">
<td><strong>File(line)</strong></td>
<td><strong>Change description</strong></td>
<td><strong>Os_Patch.bat Automation</strong></td>
</tr>
<tr class="even">
<td>intvect.asm</td>
<td><p>Removal of the generated assembler error directive. The error directive is unconditionally inserted by the Vector generator to ensure the output from the generator is reviewed prior to being built into a system. During Os configuration development at Nexteer it is necessary for the developer to build and test the generated configurations many times while implementing a change request.</p>
<p>Nexteer’s process of reviewing the Os generated configuration does not rely on a generated error directive and thus it is removed.</p></td>
<td>GNU patch utility invoked with invect.diff input.</td>
</tr>
<tr class="odd">
<td>Os_MemMap.h</td>
<td>Inclusion of #undef MEMMAP_ERROR in each memory mapping block to meet the AUTOSAR MemMap requirements</td>
<td>GNU sed utility invoked with find and replace</td>
</tr>
</tbody>
</table>
<p>* Os_Diff.bat can be invoked to update the *.diff files. It generates the *.diff based on the differences it detects between the primary file in the directory and the *.bak version of the file in the directory.</p>
<h2 id="static-code">Static Code</h2>
<p>This section describes alterations to the delivered static code files provided by the software supplier. The pertinent source file should be inspected to see the exact change. Line numbers are relative to the altered file line numbering and not the originally delivered file.</p>
<table>
<colgroup>
<col style="width: 22%" />
<col style="width: 77%" />
</colgroup>
<tbody>
<tr class="odd">
<td><strong>File(line)</strong></td>
<td><strong>Change description</strong></td>
</tr>
<tr class="even">
<td>osekasm.asm(1374)</td>
<td><p>Per Error: Reference source not found Sec. 4.1.3.3 an application Prefetch Abort handler is required.</p>
<p>Affected Function: osPrefetchAbort</p>
<p>The branch instruction is changed to branch to the Nexteer handler in place of the “osUnhandledException” handler. External declaration of function added at line 134.</p></td>
</tr>
<tr class="odd">
<td>osekasm.asm(1402)</td>
<td><p>Per Error: Reference source not found Sec. 4.1.3.3 an application Data Abort handler is required.</p>
<p>Affected Function: osDataAbort</p>
<p>The branch instruction is changed to branch to the Nexteer handler in place of the “osUnhandledException” handler. External declaration of function added at line 135.</p></td>
</tr>
</tbody>
</table>
<h1 id="revision-control-log"><br />
Revision Control Log</h1>
<table style="width:100%;">
<colgroup>
<col style="width: 6%" />
<col style="width: 6%" />
<col style="width: 64%" />
<col style="width: 11%" />
<col style="width: 11%" />
</colgroup>
<tbody>
<tr class="odd">
<td><strong>Item #</strong></td>
<td><strong>Rev #</strong></td>
<td><strong>Change Description</strong></td>
<td><strong>Date</strong></td>
<td><strong>Author Initials</strong></td>
</tr>
<tr class="even">
<td>1</td>
<td>1.0</td>
<td>Initial Creation</td>
<td>01MAR13</td>
<td>JJW</td>
</tr>
</tbody>
</table>
